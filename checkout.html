<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: Arial, sans-serif; padding: 20px; background-color: #f9f9f9; }
      h2 { color: #222; }
      label { display: block; margin-top: 10px; }
      input, textarea, select { width: 100%; padding: 8px; margin-top: 4px; border: 1px solid #ccc; border-radius: 4px; }
      button { margin-top: 20px; padding: 10px 20px; background-color: #333; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
      button:disabled { opacity: 0.5; }
      .cart-summary { background: #fff; padding: 15px; border: 1px solid #ccc; margin-top: 20px; border-radius: 4px; }
      .highlight { font-weight: bold; color: #b88d3a; }
    </style>
  </head>
  <body>
    <h2>Checkout</h2>
    <p><strong>Order ID:</strong> <span class="highlight"><?= orderId ?></span></p>

    <form id="checkoutForm">
      <input type="hidden" name="orderId" value="<?= orderId ?>">
      <label>Full Name*</label>
      <input name="name" required>
      <label>Phone No*</label>
      <input name="phone" required>
      <label>Email ID</label>
      <input name="email" type="email">
      <label>Full Address*</label>
      <textarea name="address" required></textarea>
      <label>District*</label>
      <input name="district" required>
      <label>Pincode*</label>
      <input name="pincode" required>
      <label>State*</label>
      <input name="state" required>
      <label>Digipin</label>
      <input name="digipin">

      <div class="cart-summary">
        <h3>Cart Summary</h3>
        <pre><?= decodeURIComponent(cartData) ?></pre>
      </div>

      <button type="submit">Submit Order</button>
      <div id="loading" style="display:none;">Submitting your order... <span>⏳</span></div>
      <div id="result"></div>
    </form>

    <script>
      document.getElementById('checkoutForm').addEventListener('submit', e => {
        e.preventDefault();
        document.getElementById('loading').style.display = 'block';
        document.querySelector('button').disabled = true;

        const formData = new FormData(e.target);
        const data = {};
        formData.forEach((v,k) => data[k] = v);
        data.cart = decodeURIComponent("<?= cartData ?>");

        google.script.run.withSuccessHandler(res => {
          document.getElementById('loading').style.display = 'none';
          if (res.success) {
            document.getElementById('result').innerHTML = `<p>✅ Order Confirmed! <strong>${res.orderId}</strong></p>`;
          } else {
            document.getElementById('result').innerHTML = `<p>❌ ${res.error}</p>`;
          }
        }).submitOrder(data);
      });
    </script>
  </body>
</html>
